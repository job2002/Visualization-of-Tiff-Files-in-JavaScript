<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
crossorigin=""/>

 <!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
<link rel="stylesheet" href="style.css">

<!-- Leaflet Geotiff --> 
//<script src="https://stuartmatthews.github.io/leaflet-geotiff/leaflet-geotiff.js"></script>
<script src="https://github.com/stuartmatthews/leaflet-geotiff/blob/master/leaflet-geotiff.js"></script>

<!-- Plotty --> 
<script src="https://stuartmatthews.github.io/leaflet-geotiff/vendor/plotty.js"></script>

<!-- GeoTif -->

<script src="https://cdn.jsdelivr.net/npm/geotiff"></script>
<body>
  <canvas id="canvas" width=100 height=100></canvas>
    <input type="file" id="file">
    <div id="map" :use-global-leaflet="false"></div>
<script>
    console.log(GeoTIFF)
    //Leaflet Map
    var map = L.map('map').setView([51.962331777262506, 7.623985903013933], 13);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

(async function() {
  const response = await fetch('./muenster_klassifizierung_4326_neu.tif');
const arrayBuffer = await response.arrayBuffer();
const tiff = await GeoTIFF.fromArrayBuffer(arrayBuffer);
console.log(tiff)
var layer = await L.leafletGeotiff(tiff,
            {
            name: 'Tif',
            domain: [0, 4], 
            colorScale: 'viridis'
            })
            layer.addTo(map);
    
  })();


const input = document.getElementById('file')
  input.onchange = async function() {
    


    const tiff = await GeoTIFF.fromBlob(input.files[0]);
    (async function() {
    const image = await tiff.getImage();
    const data = await image.readRasters();
      console.log(data[0])
    const canvas = document.getElementById("canvas");
    const plot = new plotty.plot({
      canvas: document.getElementById("canvas"),
      data: data[0], 
      width: image.getWidth(),
      height: image.getHeight(),
      domain: [0, 4], 
      colorScale: 'viridis'
    });
    plot.render();
    let img = data[0];
    
    //plotty.addColorScale("mycolorscale", ["#00ff00", "#0000ff", "#ff0000"], [0, 1, 2]);
    // var layer = L.leafletGeotiff(arrayBuffer,
    //         {
    //         name: 'Tif',
    //         displayMin: 0,
    //         displayMax: 255,
    //         colorScale: 'viridis'
    //         }).addTo(map);
    
  })();
    
    //let boundingBox = image.getBoundingBox();
    //console.log(image)
    //var layer = L.leafletGeotiff(plot).addTo(map);
  }
//var layer = L.leafletGeotiff("muenster_klassifizierung_4326_neu1.tif").addTo(map);
</script>
</body>
